# Specification: OpenAI File Size Check Blocks Chunking

**Track ID:** openai-size-check-bug_20250223
**Type:** Bug
**Created:** 2026-02-23
**Status:** Draft

## Summary

The file size check in OpenAIProvider.transcribe() occurs before chunking, causing ValueError for files > 25MB even when OPENAI_CHUNKING is enabled.

## Context

The bot supports large audio file transcription via chunking (OPENAI_CHUNKING=true). When a file exceeds 25MB, it should be split into smaller chunks (< 25MB each) and transcribed via OpenAI API. Currently, the file size check raises ValueError before chunking can start, forcing fallback to slower local providers like faster-whisper.

## Problem Description

### Steps to Reproduce
1. Upload audio file > 25MB (e.g., 197.90 MB)
2. Convert to mono format (28.27 MB after conversion)
3. OPENAI_CHUNKING=true, OPENAI_CHUNK_SIZE_SECONDS=420
4. Call OpenAIProvider.transcribe()
5. ValueError raised at line 129: "Audio file too large: 28.3MB (max 25MB)"

### Expected Behavior
- Files > 25MB should trigger _handle_long_audio()
- Audio should be split into 420-second chunks
- Each chunk < 25MB is transcribed via OpenAI API
- Results are concatenated

### Actual Behavior
- ValueError raised immediately at file size check
- Never reaches _handle_long_audio()
- Router switches to fallback provider (faster-whisper)

## Acceptance Criteria

- [ ] Files > 25MB with OPENAI_CHUNKING=true trigger chunking
- [ ] File size check is moved inside chunking logic or removed
- [ ] Each chunk is < 25MB and transcribed successfully
- [ ] Test added for 30MB file with chunking enabled
- [ ] No regression for files < 25MB

## Dependencies

- Existing chunking logic in _handle_long_audio()
- Routing strategy in transcription/routing/strategies.py

## Out of Scope

- Changing chunk size algorithm (currently 420 seconds)
- Modifying fallback provider behavior
- Adjusting OpenAI API limits

## Technical Notes

Root cause: File size check at lines 127-132 in openai_provider.py happens before chunking trigger at lines 134-136. Solution: Move size check inside _transcribe_single_file() or remove it entirely (let chunks fail individually if too large).

---

_Generated by Conductor. Review and edit as needed._