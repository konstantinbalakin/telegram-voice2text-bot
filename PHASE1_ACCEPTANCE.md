# –§–∞–∑–∞ 1: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ü—Ä–∏—ë–º–æ—á–Ω–æ–º—É –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## –û–±–∑–æ—Ä

–§–∞–∑–∞ 1 —Ä–µ–∞–ª–∏–∑—É–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏:
- –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π, –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∞–º–∏
- –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –§–∞–∑—ã 1)
- –°–∏—Å—Ç–µ–º–∞ —Ñ–ª–∞–≥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º**
   ```bash
   # –í —Ñ–∞–π–ª–µ .env
   INTERACTIVE_MODE_ENABLED=true
   LOG_LEVEL=DEBUG  # –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
   ```

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   uv run alembic upgrade head
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞**
   ```bash
   uv run python -m src.main
   ```

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –ü—Ä–∏—ë–º–∫–∏

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ö–Ω–æ–ø–∫–∏ (–ö–û–†–û–¢–ö–û–ï –ê–£–î–ò–û)

**–î–∞–Ω–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–∏–ª –±–æ—Ç–∞ —Å `INTERACTIVE_MODE_ENABLED=true`

**–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 30-—Å–µ–∫—É–Ω–¥–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–¢–æ–≥–¥–∞:**
1. –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ —Å –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
3. –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É: "–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç (–≤—ã –∑–¥–µ—Å—å)"

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
INFO - Processing voice message...
DEBUG - TranscriptionState created: id=X, usage_id=Y, message_id=Z
DEBUG - Segments not saved (duration 30.5s < threshold 300s)
DEBUG - Keyboard added to message Z: mode:Y:mode=original
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [x] –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- [x] –í–∏–¥–Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å 1 –∫–Ω–æ–ø–∫–æ–π
- [x] TranscriptionState —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (usage_id=Y)
- [x] –°–µ–≥–º–µ–Ω—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å < 300—Å)

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–∞–∫—Ü–∏—è –Ω–∞ –ù–∞–∂–∞—Ç–∏–µ –ö–Ω–æ–ø–∫–∏

**–î–∞–Ω–æ:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç (–≤—ã –∑–¥–µ—Å—å)" –∏–∑ –°—Ü–µ–Ω–∞—Ä–∏—è 1

**–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É

**–¢–æ–≥–¥–∞:**
1. Telegram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Ç–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ó–∞–≥—Ä—É–∑–∫–∞..."
2. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏—Å—á–µ–∑–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —Å–µ–∫—É–Ω–¥
3. –¢–µ–∫—Å—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≥–ª—É—à–∫–∏ –§–∞–∑—ã 1 - —Ä–µ–∂–∏–º "original" —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω)

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
DEBUG - callback_query_wrapper called! update type: <class 'telegram._update.Update'>
DEBUG - callback_query data: mode:Y:mode=original
INFO - Mode change request: usage_id=Y, mode=original
DEBUG - Already in original mode for usage_id=Y
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [x] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞–µ—Ç
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [x] callback_query_wrapper –±—ã–ª –≤—ã–∑–≤–∞–Ω
- [x] CallbackHandlers.handle_callback_query –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è
- [x] –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≥–ª—É—à–∫–∏)

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–ª–∏–Ω–Ω–æ–µ –ê—É–¥–∏–æ —Å –°–µ–≥–º–µ–Ω—Ç–∞–º–∏ (> 5 –º–∏–Ω—É—Ç)

**–î–∞–Ω–æ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–∏–ª –±–æ—Ç–∞ —Å `INTERACTIVE_MODE_ENABLED=true`

**–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 6-–º–∏–Ω—É—Ç–Ω–æ–µ (360—Å) –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–¢–æ–≥–¥–∞:**
1. –ë–æ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
DEBUG - TranscriptionState created: id=X, usage_id=Y, message_id=Z
DEBUG - Saved N segments for usage_id=Y, duration=360.0s
DEBUG - Keyboard added to message Z
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [x] TranscriptionState —Å–æ–∑–¥–∞–Ω
- [x] –°–µ–≥–º–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `transcription_segments`
- [x] –ú–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã: `SELECT * FROM transcription_segments WHERE usage_id=Y ORDER BY segment_index`
- [x] –ö–Ω–æ–ø–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

### ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –§–ª–∞–≥ –§—É–Ω–∫—Ü–∏–∏ –í—ã–∫–ª—é—á–µ–Ω

**–î–∞–Ω–æ:** `INTERACTIVE_MODE_ENABLED=false` –≤ .env

**–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–¢–æ–≥–¥–∞:**
1. –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
2. –ò–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è
3. TranscriptionState –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
INFO - Interactive transcription disabled
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- [x] –û–±—ã—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- [x] –ù–µ—Ç –∫–Ω–æ–ø–æ–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- [x] –í —Ç–∞–±–ª–∏—Ü–µ `transcription_states` –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
- [x] –°–µ–≥–º–µ–Ω—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TranscriptionState
```sql
SELECT * FROM transcription_states ORDER BY created_at DESC LIMIT 5;
```

–û–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
- `id`, `usage_id`, `message_id`, `chat_id`
- `active_mode` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'original')
- `length_level` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'default')
- `emoji_level` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0)
- `timestamps_enabled` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false)

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TranscriptionSegments
```sql
SELECT usage_id, COUNT(*) as segment_count, MIN(start_time), MAX(end_time)
FROM transcription_segments
GROUP BY usage_id;
```

–î–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ –¥–ª—è –∞—É–¥–∏–æ > 300—Å (5 –º–∏–Ω—É—Ç)

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ù–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. `INTERACTIVE_MODE_ENABLED=true` –≤ .env
2. –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: "Interactive transcription enabled - callback handlers registered"
3. –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `uv run alembic current`

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –Ω–æ –Ω–∞–∂–∞—Ç–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∫–∞..." –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `callback_query_wrapper called!`
   - ‚úÖ –ï—Å–ª–∏ –î–ê: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback
   - ‚ùå –ï—Å–ª–∏ –ù–ï–¢: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

2. –ï—Å–ª–∏ wrapper –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
   ```python
   # –í src/main.py –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 169
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ CallbackQueryHandler –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:
   application.add_handler(CallbackQueryHandler(callback_query_wrapper))
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç callback_data –≤ –ª–æ–≥–∞—Ö:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `mode:124:mode=original`
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å < 64 –±–∞–π—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é python-telegram-bot: `uv pip show python-telegram-bot`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±—ä–µ–∫—Ç–∞ Update –≤ –ª–æ–≥–∞—Ö

---

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏

**–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:**
- `Failed to decode callback data`: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–∫—É encode/decode –≤ `src/bot/keyboards.py`
- `State not found`: TranscriptionState –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `Database locked`: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é SQLite - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

---

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –ö–∞—á–µ—Å—Ç–≤–∞ –ö–æ–¥–∞

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –í—Å–µ –¢–µ—Å—Ç—ã
```bash
uv run pytest -v
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –í—Å–µ 108 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–∏–ø–æ–≤
```bash
uv run mypy src/
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Success: no issues found
```

### –õ–∏–Ω—Ç–∏–Ω–≥
```bash
uv run ruff check src/
# –û–∂–∏–¥–∞–µ—Ç—Å—è: No errors
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
uv run black src/ --check
# –û–∂–∏–¥–∞–µ—Ç—Å—è: All done! ‚ú® üç∞ ‚ú®
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 1

- [x] –°–æ–∑–¥–∞–Ω—ã –º–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (TranscriptionState, TranscriptionVariant, TranscriptionSegment)
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è Alembic —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [x] –°–µ–≥–º–µ–Ω—Ç—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ faster-whisper
- [x] –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ñ–ª–∞–≥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- [x] –°–æ–∑–¥–∞–Ω—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- [x] **–ì–û–¢–û–í–û**: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω allowed_updates)
- [x] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (108/108)
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç (mypy - no issues)
- [x] –õ–∏–Ω—Ç–∏–Ω–≥ –ø—Ä–æ—Ö–æ–¥–∏—Ç (ruff - all checks passed)
- [x] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ (4 —Å—Ü–µ–Ω–∞—Ä–∏—è –≤—ã—à–µ)

## ‚úÖ –§–∞–∑–∞ 1 –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-12-03

**–ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
1. –î–æ–±–∞–≤–ª–µ–Ω `allowed_updates=Update.ALL_TYPES` –≤ `start_polling()` - —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –±–æ—Ç—É –ø–æ–ª—É—á–∞—Ç—å callback_query updates
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å undefined `draft_text` –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º LLM refinement
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö incoming updates –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∫–Ω–æ–ø–∫–∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏—è.

---

## –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ –ü–æ—Å–ª–µ –§–∞–∑—ã 1

–ö–æ–≥–¥–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:

**–§–∞–∑–∞ 2**: –†–µ–∂–∏–º –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¢–µ–∫—Å—Ç–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LLM (–¥–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é, –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã)
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

**–§–∞–∑–∞ 3**: –í–∞—Ä–∏–∞—Ü–∏–∏ –î–ª–∏–Ω—ã
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ "–ö–æ—Ä–æ—á–µ" / "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LLM

**–§–∞–∑–∞ 4**: –†–µ–∂–∏–º –†–µ–∑—é–º–µ
- –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º "–†–µ–∑—é–º–µ"
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–µ —Ä–µ–∑—é–º–µ —á–µ—Ä–µ–∑ LLM

–°–º. `memory-bank/plans/2025-12-02-interactive-transcription-processing.md` –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã.
